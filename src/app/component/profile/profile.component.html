<div class="profile-container">
  <div class="profile-layout">
    <!-- Clean Sidebar Navigation -->
    <div class="profile-sidebar">
      <div class="sidebar-header">
        <h3>Dashboard</h3>
      </div>
      <nav class="sidebar-nav">
        <a class="nav-link" [class.active]="activeTab === 'profile'" (click)="setActiveTab('profile')">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
          <span>Profile</span>
        </a>
        <a class="nav-link" [class.active]="activeTab === 'recipes'" (click)="setActiveTab('recipes')">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 9h-4v4h-2v-4H7V9h4V5h2v4h4v2z"/>
          </svg>
          <span>My Recipes</span>
        </a>
        <a class="nav-link" [class.active]="activeTab === 'favorites'" (click)="setActiveTab('favorites')">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
          </svg>
          <span>Favorites</span>
        </a>
        <a class="nav-link" [class.active]="activeTab === 'saved'" (click)="setActiveTab('saved')">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
          </svg>
          <span>Saved</span>
        </a>
        <a class="nav-link" [class.active]="activeTab === 'settings'" (click)="setActiveTab('settings')">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
          </svg>
          <span>Settings</span>
        </a>
      </nav>
    </div>

    <!-- Main Content Area -->
    <div class="profile-main">
      <ng-container *ngIf="isLoading; else content">
        <div class="loading-container">
          <div class="loader"></div>
          <p class="loading-text">Loading profile...</p>
        </div>
      </ng-container>

      <ng-template #content>
        <!-- Profile Tab -->
        <div class="profile-view" *ngIf="activeTab === 'profile' && user">
          <!-- Cover Section -->
          <div class="cover-section">
            <div class="cover-image" [ngStyle]="{'background-image': 'url(' + getCoverImageUrl(user.coverPicture) + ')'}">
            </div>
          </div>
          
          <!-- Profile Header -->
          <div class="profile-header">
            <div class="avatar-section">
              <div class="avatar-wrapper">
                <div class="avatar-image" [ngStyle]="{'background-image': 'url(' + getProfileImageUrl(user.profilePicture) + ')'}">
                </div>
              </div>
              
              <div class="profile-info">
                <h1 class="username">{{ user.username }}</h1>
                <p class="tagline">{{ user.tagline || 'Food enthusiast' }}</p>
                <div class="user-level">
                  <span class="level-badge">{{ userLevel }}</span>
                </div>
              </div>
            </div>
            
            <div class="header-actions">
              <button class="action-btn primary" (click)="toggleEdit()">
                <svg class="btn-icon" viewBox="0 0 24 24">
                  <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                </svg>
                {{ isEditing ? 'Cancel Edit' : 'Edit Profile' }}
              </button>
            </div>
          </div>

          <!-- Stats Section -->
          <div class="stats-section">
            <div class="stats-grid">
              <div class="stat-item" *ngFor="let stat of getStats()">
                <svg class="stat-icon" viewBox="0 0 24 24" [attr.fill]="stat.iconColor || '#666'">
                  <path [attr.d]="stat.iconPath"/>
                </svg>
                <div class="stat-details">
                  <div class="stat-value">{{ stat.value }}</div>
                  <div class="stat-label">{{ stat.label }}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Profile Content Sections -->
          <div class="content-sections" *ngIf="!isEditing">
            <!-- About Section -->
            <section class="content-section about-section">
              <h2 class="section-title">
                <svg class="section-icon" viewBox="0 0 24 24">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                About
              </h2>
              
              <div class="section-content immersive-content">
                <div class="bio-card">
                  <p class="bio">{{ user.bio || 'No bio added yet' }}</p>
                </div>
                
                <div class="details-grid">
                  <div class="detail-item" *ngIf="user.location">
                    <svg class="detail-icon" viewBox="0 0 24 24">
                      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                    <div>
                      <div class="detail-label">Location</div>
                      <div class="detail-value">{{ user.location }}</div>
                    </div>
                  </div>
                  
                  <div class="detail-item" *ngIf="user.website">
                    <svg class="detail-icon" viewBox="0 0 24 24">
                      <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
                    </svg>
                    <div>
                      <div class="detail-label">Website</div>
                      <a [href]="user.website" target="_blank" class="detail-value link">{{ user.website }}</a>
                    </div>
                  </div>
                  
                  <div class="detail-item" *ngIf="user.cookingStyle">
                    <svg class="detail-icon" viewBox="0 0 24 24">
                      <path d="M8.1 13.34L3.91 9.16c-1.11-1.11-1.11-2.92 0-4.03s2.92-1.11 4.03 0l4.19 4.18 4.19-4.18c1.11-1.11 2.92-1.11 4.03 0s1.11 2.92 0 4.03l-4.19 4.18 4.19 4.19c1.11 1.11 1.11 2.92 0 4.03s-2.92 1.11-4.03 0L12 17.54l-4.19 4.19c-1.11 1.11-2.92 1.11-4.03 0s-1.11-2.92 0-4.03l4.19-4.19z"/>
                    </svg>
                    <div>
                      <div class="detail-label">Cooking Style</div>
                      <div class="detail-value">{{ user.cookingStyle }}</div>
                    </div>
                  </div>
                  
                  <div class="detail-item">
                    <svg class="detail-icon" viewBox="0 0 24 24">
                      <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM5 6v2h14V6H5zm2 4h10v2H7zm0 4h7v2H7z"/>
                    </svg>
                    <div>
                      <div class="detail-label">Member Since</div>
                      <div class="detail-value">{{ formatDate(user.createdAt) }}</div>
                    </div>
                  </div>
                </div>
                
                <!-- Tags Section -->
                <div class="tags-section" *ngIf="(user.interests && user.interests.length > 0) || (user.specialties && user.specialties.length > 0)">
                  <div class="tags-group" *ngIf="user.interests && user.interests.length > 0">
                    <h3 class="tags-title">Interests</h3>
                    <div class="tags">
                      <span class="tag" *ngFor="let interest of user.interests">{{ interest }}</span>
                    </div>
                  </div>
                  
                  <div class="tags-group" *ngIf="user.specialties && user.specialties.length > 0">
                    <h3 class="tags-title">Specialties</h3>
                    <div class="tags">
                      <span class="tag" *ngFor="let specialty of user.specialties">{{ specialty }}</span>
                    </div>
                  </div>
                </div>
                
                <!-- Social Links -->
                <div class="social-section" *ngIf="user.socialMedia && hasSocialMedia(user.socialMedia)">
                  <h3 class="social-title">Connect</h3>
                  <div class="social-links">
                    <a *ngIf="user.socialMedia.twitter" 
                       [href]="'https://twitter.com/' + (user.socialMedia.twitter || '')" 
                       target="_blank" class="social-link" title="Twitter">
                      <svg viewBox="0 0 24 24">
                        <path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/>
                      </svg>
                    </a>
                    <a *ngIf="user.socialMedia.instagram" 
                       [href]="'https://instagram.com/' + (user.socialMedia.instagram || '')" 
                       target="_blank" class="social-link" title="Instagram">
                      <svg viewBox="0 0 24 24">
                        <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8 1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3z"/>
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
            </section>

            <!-- Recent Activity -->
            <section class="content-section" *ngIf="recentRecipes.length > 0 || recentReviews.length > 0">
              <h2 class="section-title">
                <svg class="section-icon" viewBox="0 0 24 24">
                  <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                </svg>
                Recent Activity
              </h2>
              
              <div class="activity-feed">
                <div class="activity-list" *ngIf="recentRecipes.length > 0">
                  <div class="activity-item" *ngFor="let recipe of recentRecipes">
                    <div class="activity-icon">
                      <svg viewBox="0 0 24 24">
                        <path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 9h-4v4h-2v-4H7V9h4V5h2v4h4v2z"/>
                      </svg>
                    </div>
                    <div class="activity-content">
                      <p>Created recipe <strong>{{ recipe.title }}</strong></p>
                      <span class="activity-time">{{ formatDate(recipe.createdAt) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>

        <!-- Edit Form Modal Overlay -->
        <div class="edit-modal" *ngIf="isEditing">
          <div class="modal-content">
            <div class="modal-header">
              <h2>Edit Profile</h2>
              <button class="close-btn" (click)="toggleEdit()">
                <svg viewBox="0 0 24 24">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </button>
            </div>
            
            <form [formGroup]="profileForm" (ngSubmit)="updateProfile()" class="edit-form">
              <div class="form-section">
                <h3>Profile Images</h3>
                <div class="form-grid">
                  <div class="form-group full-width">
                    <label>Profile Picture</label>
                    <div class="image-preview-wrapper">
                      <div class="image-preview" [ngStyle]="{'background-image': 'url(' + getProfileImageUrl(user?.profilePicture) + ')'}"></div>
                      <button type="button" class="image-upload-btn" (click)="triggerFileInput('avatar')" title="Change profile picture">
                        <svg viewBox="0 0 24 24">
                          <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/>
                        </svg>
                      </button>
                    </div>
                    <input type="file" id="avatarInput" (change)="handleAvatarChange($event)" accept="image/*" hidden>
                  </div>
                  <div class="form-group full-width">
                    <label>Cover Picture</label>
                    <div class="image-preview-wrapper cover-preview">
                      <div class="image-preview cover-preview-image" [ngStyle]="{'background-image': 'url(' + getCoverImageUrl(user?.coverPicture) + ')'}"></div>
                      <button type="button" class="image-upload-btn" (click)="triggerFileInput('cover')" title="Change cover picture">
                        <svg viewBox="0 0 24 24">
                          <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/>
                        </svg>
                      </button>
                    </div>
                    <input type="file" id="coverInput" (change)="handleCoverChange($event)" accept="image/*" hidden>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3>Basic Information</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label>Username</label>
                    <input type="text" formControlName="username" class="form-input">
                    <div class="error" *ngIf="profileForm.get('username')?.invalid && profileForm.get('username')?.touched">
                      Username must be at least 3 characters
                    </div>
                  </div>
                  <div class="form-group">
                    <label>Email</label>
                    <input type="email" formControlName="email" class="form-input">
                    <div class="error" *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
                      Please enter a valid email
                    </div>
                  </div>
                  <div class="form-group">
                    <label>Tagline</label>
                    <input type="text" formControlName="tagline" placeholder="Brief description" class="form-input">
                  </div>
                  <div class="form-group full-width">
                    <label>Bio</label>
                    <textarea formControlName="bio" rows="3" placeholder="Tell us about yourself..." class="form-input"></textarea>
                    <div class="char-count">{{ profileForm.get('bio')?.value?.length || 0 }}/500</div>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3>Location & Details</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label>Location</label>
                    <input type="text" formControlName="location" placeholder="City, Country" class="form-input">
                  </div>
                  <div class="form-group">
                    <label>Website</label>
                    <input type="url" formControlName="website" placeholder="https://example.com" class="form-input">
                  </div>
                  <div class="form-group">
                    <label>Cooking Style</label>
                    <input type="text" formControlName="cookingStyle" placeholder="e.g., Italian, Vegan" class="form-input">
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3>Interests & Tags</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label>Interests</label>
                    <div class="tags-input">
                      <div class="tags-container">
                        <span class="tag" *ngFor="let interest of interestsArray.controls; let i = index">
                          {{ interest.value }}
                          <button type="button" class="tag-remove" (click)="removeArrayItem('interests', i)">
                            <svg viewBox="0 0 24 24">
                              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                          </button>
                        </span>
                      </div>
                      <div class="tag-add">
                        <input type="text" #interestInput placeholder="Add interest" class="tag-input">
                        <button type="button" class="tag-add-btn" (click)="addArrayItem('interests', interestInput.value); interestInput.value = ''">
                          <svg viewBox="0 0 24 24">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label>Specialties</label>
                    <div class="tags-input">
                      <div class="tags-container">
                        <span class="tag" *ngFor="let specialty of specialtiesArray.controls; let i = index">
                          {{ specialty.value }}
                          <button type="button" class="tag-remove" (click)="removeArrayItem('specialties', i)">
                            <svg viewBox="0 0 24 24">
                              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                          </button>
                        </span>
                      </div>
                      <div class="tag-add">
                        <input type="text" #specialtyInput placeholder="Add specialty" class="tag-input">
                        <button type="button" class="tag-add-btn" (click)="addArrayItem('specialties', specialtyInput.value); specialtyInput.value = ''">
                          <svg viewBox="0 0 24 24">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3>Social Media</h3>
                <div formGroupName="socialMedia" class="form-grid">
                  <div class="form-group">
                    <label>Twitter</label>
                    <div class="social-input">
                      <span class="social-prefix">&#64;</span>
                      <input type="text" formControlName="twitter" placeholder="username" class="form-input">
                    </div>
                  </div>
                  <div class="form-group">
                    <label>Instagram</label>
                    <div class="social-input">
                      <span class="social-prefix">&#64;</span>
                      <input type="text" formControlName="instagram" placeholder="username" class="form-input">
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-actions">
                <button type="submit" class="save-btn" [disabled]="profileForm.invalid || isUpdating">
                  <span *ngIf="isUpdating" class="spinner"></span>
                  {{ isUpdating ? 'Saving...' : 'Save Changes' }}
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- My Recipes Tab -->
        <div class="tab-content" *ngIf="activeTab === 'recipes'">
          <app-my-recipes></app-my-recipes>
        </div>

        <!-- Favorite Recipes Tab -->
        <div class="tab-content" *ngIf="activeTab === 'favorites'">
          <app-favorite-recipes></app-favorite-recipes>
        </div>

        <!-- Saved Recipes Tab -->
        <div class="tab-content" *ngIf="activeTab === 'saved'">
          <app-saved-recipes></app-saved-recipes>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" *ngIf="activeTab === 'settings'">
          <app-settings></app-settings>
        </div>

        <!-- No User Message -->
        <div class="empty-state" *ngIf="activeTab === 'profile' && !user">
          <svg class="empty-icon" viewBox="0 0 24 24">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
          <h3>No Profile Found</h3>
          <p>Please log in to view your profile</p>
        </div>
      </ng-template>
    </div>
  </div>
</div>