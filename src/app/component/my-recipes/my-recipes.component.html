<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>My Recipes</h1>
    <a routerLink="/add-recipe" class="btn btn-primary">
      <i class="bi bi-plus-lg"></i> Add Recipe
    </a>
  </div>

  <!-- Success Message - Fixed multiple *ngIf issue -->
  <div *ngIf="!errorMessage && recipes.length > 0" class="alert alert-success mt-3">
    You have {{ recipes.length }} recipe{{ recipes.length !== 1 ? 's' : '' }}
  </div>

  <ng-container *ngIf="isLoading; else content">
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading your recipes...</p>
    </div>
  </ng-container>

  <ng-template #content>
    <ng-container *ngIf="recipes.length > 0; else noRecipes">
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <div class="col" *ngFor="let recipe of recipes; trackBy: trackByRecipeId">
          <div class="card h-100">
            <img [src]="recipe.imageUrl || 'assets/recipe-placeholder.jpg'" 
                 class="card-img-top recipe-image" 
                 [alt]="recipe.title || 'Recipe'"
                 (error)="handleImageError($event)"
                 style="height: 200px; object-fit: cover;">
            <div class="card-body">
              <h5 class="card-title">{{ recipe.title || 'Untitled Recipe' }}</h5>
              <p class="card-text text-muted">{{ (recipe.description || 'No description available') | slice:0:100 }}{{ recipe.description && recipe.description.length > 100 ? '...' : '' }}</p>
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted small">
                  <i class="bi bi-clock"></i> {{ (recipe.prepTime || 0) + (recipe.cookTime || 0) }} mins
                </span>
                <span class="text-muted small">
                  <i class="bi bi-star-fill text-warning"></i> 
                  {{ recipe.rating ? (recipe.rating | number:'1.1-1') : 'Not rated' }}
                </span>
              </div>
            </div>
            <div class="card-footer bg-transparent">
              <div class="d-flex justify-content-between">
                <a [routerLink]="['/recipes', recipe._id]" class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-eye"></i> View
                </a>
                <a [routerLink]="['/edit-recipe', recipe._id]" class="btn btn-sm btn-outline-secondary">
                  <i class="bi bi-pencil"></i> Edit
                </a>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteRecipe(recipe._id)">
                  <i class="bi bi-trash"></i> Delete
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-template #noRecipes>
      <div class="alert alert-info text-center">
        <i class="bi bi-journal-bookmark display-4 d-block mb-3"></i>
        <h4>You haven't created any recipes yet</h4>
        <p class="mb-3">Share your culinary creations with the community</p>
        <a routerLink="/recipes/new" class="btn btn-primary">
          <i class="bi bi-plus-lg"></i> Add Your First Recipe
        </a>
      </div>
    </ng-template>
  </ng-template>

  <div *ngIf="errorMessage" class="alert alert-danger mt-3">
    <i class="bi bi-exclamation-triangle"></i> {{ errorMessage }}
  </div>
</div>